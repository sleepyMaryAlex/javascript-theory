# ?Patterns and flags

_Регулярные выражения_ – мощное средство поиска и замены в строке.

В JavaScript регулярные выражения реализованы отдельным объектом `RegExp` и интегрированы в методы строк.

### Регулярные выражения

Регулярное выражение состоит из шаблона (также говорят «паттерн») и необязательных флагов.

Существует два синтаксиса для создания регулярного выражения.

1. «Длинный» синтаксис:

~~~
regexp = new RegExp("шаблон", "флаги");
~~~

2. …И короткий синтаксис, использующий слеши `"/"`:

~~~
regexp = /шаблон/; // без флагов
regexp = /шаблон/gmi; // с флагами gmi (будут описаны далее)
~~~

Слеши `/.../` говорят JavaScript о том, что это регулярное выражение. Они играют здесь ту же роль, что и кавычки для обозначения строк.

Регулярное выражение `regexp` в обоих случаях является объектом встроенного класса `RegExp`.

Основная разница между этими двумя способами создания заключается в том, что слеши `/.../` не допускают никаких вставок переменных (наподобие возможных в строках через `${...}`). Они полностью статичны.

Слеши используются, когда мы на момент написания кода точно знаем, каким будет регулярное выражение – и это большинство ситуаций. А `new RegExp` – когда мы хотим создать регулярное выражение «на лету» из динамически сгенерированной строки, например:

~~~
const tag = prompt("Какой тег вы хотите найти?", "h2");

const regexp = new RegExp(`<${tag}>`); // то же, что /<h2>/  при ответе "h2" на prompt выше
~~~

### Флаги

Регулярные выражения могут иметь флаги, которые влияют на поиск.

В JavaScript их всего шесть:

1. `i`. С этим флагом поиск не зависит от регистра: нет разницы между `A` и `a`.
2. `g`. С этим флагом поиск ищет все совпадения, без него – только первое.
3. `m`. Многострочный режим.
4. `s`. Включает режим «dotall», при котором точка `.` может соответствовать символу перевода строки `\n`.
5. `u`. Включает полную поддержку Юникода. Флаг разрешает корректную обработку суррогатных пар.
6. `y`. Режим поиска на конкретной позиции в тексте.

### Поиск: `str.match`

Как уже говорилось, использование регулярных выражений интегрировано в методы строк.

Метод `str.match(regexp)` для строки `str` возвращает совпадения с регулярным выражением `regexp`.

У него есть три режима работы:

1. Если у регулярного выражения есть флаг `g`, то он возвращает массив всех совпадений:

~~~
const str = "Run, Forrest, Run!";

console.log(str.match(/run/gi)); // ['Run', 'Run']
~~~
Обратите внимание: `Run` найдены благодаря флагу `i`, который делает регулярное выражение регистронезависимым.

2. Если нет флага `g`, то возвращает только первое совпадение в виде массива, в котором по индексу `0` находится совпадение, и есть свойства с дополнительной информацией о нём:

~~~
const str = "Run, Forrest, Run!";

const result = str.match(/run/i); // ['Run', 'Run']
console.log(result[0]); // Run
console.log(result.length); // 1
~~~

~~~
// Дополнительная информация:
console.log(result.index); // 0 (позиция совпадения)
console.log(result.input); // Run, Forrest, Run! (исходная строка)
~~~

3. И, наконец, если совпадений нет, то, вне зависимости от наличия флага `g`, возвращается `null`.

Это очень важный нюанс. При отсутствии совпадений возвращается не пустой массив, а именно `null`.

### Замена: `str.replace`

Метод `str.replace(regexp, replacement)` заменяет совпадения с `regexp` в строке `str` на `replacement` (все, если есть флаг `g`, иначе только первое).

~~~
// без флага g
console.log("We will, we will".replace(/we/i, "I")); // I will, we will

// с флагом g
console.log("We will, we will".replace(/we/gi, "I")); // I will, I will
~~~

В строке замены `replacement` мы можем использовать специальные комбинации символов для вставки фрагментов совпадения:

| Спецсимволы	| Действие в строке замены |
|---|---|
| `$&` | вставляет всё найденное совпадение |
| `` $` `` | вставляет часть строки до совпадения |
| `$'` | вставляет часть строки после совпадения |
| `$n` | если `n` это 1-2 значное число, вставляет содержимое `n`-й скобочной группы регулярного выражения |
| `$<name>`	| вставляет содержимое скобочной группы с именем `name` |
| `$$` | вставляет символ `"$"` |

Пример с `$&`:

~~~
console.log("Люблю HTML".replace(/HTML/, "$& и JavaScript")); // Люблю HTML и JavaScript
~~~

### Проверка: `regexp.test`

Метод `regexp.test(str)` проверяет, есть ли хоть одно совпадение, если да, то возвращает `true`, иначе `false`.

~~~
const str = "Я ЛюБлЮ JavaScript";
const regexp = /люблю/i;

console.log(regexp.test(str)); // true
~~~
